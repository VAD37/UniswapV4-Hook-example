# UniV4 Rehypo


## Short description

Swap tokens without immediate swap fees* in our private liquidity pool. Fees become deposits you can withdraw anytime or let accrue interest. We reinvest these funds into other projects, returning profits to users.

## Long Description

Our project harnesses the new hookback features of Uniswap V4 to introduce an innovative approach to liquidity pools and swap fees. We have created a "private liquidity pool" where:

- No Immediate Swap Fees: Users can swap tokens without paying a swap fee upfront. Instead, the fee amount is considered a deposit or collateral from the user.

- User Fee as Investment: The swap fee that would typically be charged is used by the project as collateral to invest elsewhere. This process is known as "rehypothecation", where we utilize the pledged assets to support additional investments.

- User Options:
  - Withdraw Anytime: Users can withdraw their collateral (the swap fee amount) at any time. This effectively makes their swap a zero-fee transaction, although withdrawing may incur standard gas costs.
  - Long-Term Investment: Users can choose to leave their fee deposited with us as a long-term investment. In return, they receive our governance token, which represents a share in the project's revenue. This allows users to benefit from the extra returns generated by our investments.

- Earning Interest: If users opt not to withdraw their collateral immediately, the deposited fee amount will accrue fixed-interest over time. This provides an additional incentive for users to participate in the project and keep their funds invested.

- Efficient Capital Use: By using the users' fees as collateral, we can operate with a smaller "private liquidity pool" while still providing ample liquidity for swaps. This enhances capital efficiency and allows us to generate additional returns through strategic investments.

- Batch Processing of Refund swap-fee: With transaction signature approval, users can have their collateral refunded without the hassle of creating a new transaction. Simply provide us with a signed signature, and we will refund your deposit at a much lower gas overhead cost by batching refund transactions.

### How it's made

Developing on Uniswap V4's Hooks presents significant challenges due to complex internal logic:
- Hooks do not benefit from transient storage: While the `PoolManager` extensively uses transient storage, Hooks cannot leverage it effectively because there's no post-swap state callback. This forces Hooks to perform heavy computations during each swap callback instead of settling once at the end, leading to increased gas costs.


- Difficulty writing Hooks without custom Router code: Some specialized Hooks are hard to implement without additional custom Router code. For example, when `Hooks.afterSwap()` is called with `AFTER_SWAP_RETURNS_DELTA_FLAG`, the Hook contract receives the user's debt or surplus balance but cannot settle these balances without extra calls during `PoolManager.UnlockCallback()`.

- Confusing token flow management: Hooks lack full control over who should pay tokens back to the pool, making it challenging to manage token flows. Unlike previous versions that only required getting back enough tokens as needed, Uniswap V4 tracks balances from each actor interacting with the pool and requires each actor to independently call `settle()` to clear their debts, which is a heavy task and adds complexity to the process.

### Checklist

Requirements:
- Safety on all authentication
- Double check with internal audit after finish core features
- All key feats should be decentralized
- Guarantee profit go to both user and liquidity provider
- Portfolio and total asset/debt is shared between protocol depositor
- Guarantee total balance never go negative

Core feats:
- [ ] CompoundToken to user with fixed interest rate
- [ ] Mint new Ctoken as fee refund cashback to user on each UniV4 swap
- [ ] Make an asset management contracts to handle withdraw/deposit Ctoken as cash to user
- [ ] Allow anyone to withdraw liquidity from UniV4 as cash refund to user
- [ ] Allow aynone to move excess liquidity and reinvest
- [ ] implement single token invest project like Aave,Compound.
- [ ] GovAction: all admin action
- [ ] AssetManager: to handle money surplus from pool to invest into External market.
- [ ] ERC4626 track total assets as liquidity from everywhere
- [ ] Voting token
- [ ] Split profit based on original deposit,erc4626 share and voting token
- [ ] Liquidity Pool evaluation of total assets value.
- [ ] How would eth price affect total assets?


Notes:
- there are 2 ways to implement Hook: Honest and discreet.
- HonestHook just say fee is 0,5% and we will refund it.
- Discrete just say 0% but internal hook calculation manually take 0.5% fee from either input or output and donate to pool. Then refund user other token.
- TickSpacing can be 32767. Check if this is allow better gas performance for private pool.